<div class="p-2 md:p-8 bg-gray-50 min-h-[80vh]">
  <!-- Header Row: Title/Subtitle left, Add User right -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
    <div>
      <h2 class="text-2xl md:text-3xl font-bold header-gradient flex items-center gap-2">
        <span>
          <svg xmlns="http://www.w3.org/2000/svg" class="inline w-8 h-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87M16 3.13a4 4 0 010 7.75M8 3.13a4 4 0 000 7.75" />
          </svg>
        </span>
        User Management
      </h2>
      <p class="text-gray-500 mt-1">Manage users, roles, and permissions with ease</p>
    </div>
    <button id="addUserBtn" class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-6 py-2 rounded-lg text-base font-semibold shadow hover:from-blue-600 hover:to-indigo-600 transition flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Add New User
    </button>
  </div>

  <!-- Summary Cards Row (Box/Card Design) -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-6">
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col min-w-[220px] relative">
      <div class="flex items-center justify-between w-full mb-2">
        <span class="font-semibold">Total Users</span>
        <span class="bg-gray-100 p-2 rounded-full">
          <!-- User group icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87M16 7a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
        </span>
      </div>
      <div class="text-3xl font-bold" id="total-users-count">0</div>
      <div class="text-xs text-gray-500">registered users</div>
      <div class="absolute left-0 bottom-0 w-full h-1 rounded-b-2xl bg-blue-500"></div>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col min-w-[220px] relative">
      <div class="flex items-center justify-between w-full mb-2">
        <span class="font-semibold">Active Users</span>
        <span class="bg-gray-100 p-2 rounded-full">
          <!-- Check circle icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="white"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2l4-4" />
          </svg>
        </span>
      </div>
      <div class="text-3xl font-bold" id="active-users-count">0</div>
      <div class="text-xs text-gray-500">currently active</div>
      <div class="absolute left-0 bottom-0 w-full h-1 rounded-b-2xl bg-green-500"></div>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col min-w-[220px] relative">
      <div class="flex items-center justify-between w-full mb-2">
        <span class="font-semibold">Inactive Users</span>
        <span class="bg-gray-100 p-2 rounded-full">
          <!-- Cross circle icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="white"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 9l-6 6m0-6l6 6" />
          </svg>
        </span>
      </div>
      <div class="text-3xl font-bold" id="inactive-users-count">0</div>
      <div class="text-xs text-gray-500">currently inactive</div>
      <div class="absolute left-0 bottom-0 w-full h-1 rounded-b-2xl bg-red-500"></div>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col min-w-[220px] relative">
      <div class="flex items-center justify-between w-full mb-2">
        <span class="font-semibold">Pending Users</span>
        <span class="bg-gray-100 p-2 rounded-full">
          <!-- Clock icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="white"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l2 2" />
          </svg>
        </span>
      </div>
      <div class="text-3xl font-bold" id="pending-users-count">0</div>
      <div class="text-xs text-gray-500">awaiting approval</div>
      <div class="absolute left-0 bottom-0 w-full h-1 rounded-b-2xl bg-yellow-400"></div>
    </div>
  </div>

  <!-- Search and Filter Row -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
    <div class="relative w-full md:w-72">
      <span class="absolute inset-y-0 left-3 flex items-center text-gray-400">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17 11A6 6 0 105 11a6 6 0 0012 0z"/>
        </svg>
      </span>
      <input id="user-search" type="text" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-200" />
    </div>
    <div class="flex gap-2 mt-2 md:mt-0">
      <button class="user-filter-tab px-4 py-1 rounded-full font-semibold text-sm bg-blue-600 text-white" data-filter="all">All</button>
      <button class="user-filter-tab px-4 py-1 rounded-full font-semibold text-sm bg-gray-100 text-gray-700 hover:bg-green-100 hover:text-green-700" data-filter="active">Active</button>
      <button class="user-filter-tab px-4 py-1 rounded-full font-semibold text-sm bg-gray-100 text-gray-700 hover:bg-red-100 hover:text-red-700" data-filter="inactive">Inactive</button>
      <button class="user-filter-tab px-4 py-1 rounded-full font-semibold text-sm bg-gray-100 text-gray-700 hover:bg-yellow-100 hover:text-yellow-700" data-filter="pending">Pending</button>
    </div>
  </div>

  <!-- User Table (Modern Card Design) -->
  <div id="userManagementContainer" class="bg-white border border-gray-200 rounded-2xl shadow-sm p-4 md:p-6 min-h-[400px] overflow-x-auto w-full">
    <!-- Table will be rendered dynamically by JS. Username column should include a user avatar (gradient circle with initial) left of the username, using flex layout. -->
  </div>

  <!-- User Management Info Section -->
  <!-- Removed User Management Tips and User Role Summary as per request -->
  <!-- Edit User Modal Placeholder -->
  <div id="edit-user-modal-root"></div>
  <!-- Delete User Modal Placeholder -->
  <div id="delete-user-modal-root"></div>
</div>
<!-- Delete User Confirmation Modal -->
<div id="delete-user-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
    <div class="text-lg font-semibold mb-4">Delete User</div>
    <div id="delete-user-modal-msg" class="mb-4 text-gray-700">Are you sure you want to delete this user?</div>
    <div class="flex justify-center gap-4 mt-6">
      <button id="delete-user-confirm" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 font-semibold">Delete</button>
      <button id="delete-user-cancel" class="bg-gray-200 text-gray-700 px-6 py-2 rounded hover:bg-gray-300 font-semibold">Cancel</button>
    </div>
  </div>
</div>
<script>
(function() {
  let pendingDeleteUserId = null;
  let pendingDeleteUsername = '';
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('userManagementContainer');
    const modal = document.getElementById('delete-user-modal');
    const msg = document.getElementById('delete-user-modal-msg');
    const confirmBtn = document.getElementById('delete-user-confirm');
    const cancelBtn = document.getElementById('delete-user-cancel');
    // Delegate delete button clicks
    container.addEventListener('click', function(e) {
      let btn = e.target;
      // Traverse up to the button if SVG or path is clicked
      while (btn && !btn.classList.contains('delete-user-btn') && btn !== container) {
        btn = btn.parentElement;
      }
      if (btn && btn.classList.contains('delete-user-btn')) {
        const userId = btn.getAttribute('data-id');
        // Extract only the username (not the avatar letter)
        const username = btn.closest('tr').querySelector('td span:nth-child(2)').innerText.trim();
        pendingDeleteUserId = userId;
        pendingDeleteUsername = username;
        msg.textContent = `Delete user '${username}'? This cannot be undone.`;
        modal.classList.remove('hidden');
      }
    });
    confirmBtn.onclick = function() {
      if (!pendingDeleteUserId) return;
      fetch(`/admin_users/${pendingDeleteUserId}`, { method: 'DELETE' })
        .then(resp => resp.json())
        .then(data => {
          if (data.status === 'success') {
            showToast('User deleted!', 'success');
            // Remove user from global and re-render
            window._allUsers = window._allUsers.filter(u => u.id != pendingDeleteUserId);
            if (typeof renderUserManagement === 'function') renderUserManagement();
            if (window.refreshAdminDashboardSummary) window.refreshAdminDashboardSummary();
            if (window.refreshAdminRecentActivity) window.refreshAdminRecentActivity();
          } else {
            showToast(data.error || 'Failed to delete user.', 'error');
          }
          modal.classList.add('hidden');
          pendingDeleteUserId = null;
        })
        .catch(() => {
          showToast('Error deleting user.', 'error');
          modal.classList.add('hidden');
          pendingDeleteUserId = null;
        });
    };
    cancelBtn.onclick = function() {
      modal.classList.add('hidden');
      pendingDeleteUserId = null;
    };
  });

  // Patch: Render edit/delete icons in the user table
  window.renderUserManagement = function() {
    if (!window._allUsers) return;
    const users = window._allUsers;
    let html = `<table class="min-w-full text-sm">
      <thead>
        <tr class="border-b">
          <th class="text-left py-2 px-4 font-semibold">Username</th>
          <th class="text-left py-2 px-4 font-semibold">Role</th>
          <th class="text-left py-2 px-4 font-semibold">Created</th>
          <th class="text-left py-2 px-4 font-semibold">Actions</th>
        </tr>
      </thead>
      <tbody>`;
    for (const user of users) {
      html += `<tr class="border-b hover:bg-gray-50">
        <td class="py-2 px-4 flex items-center gap-3">
          <span class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-blue-200 text-blue-700 font-bold text-lg">${user.username.charAt(0).toUpperCase()}</span>
          <span>${user.username}</span>
        </td>
        <td class="py-2 px-4">${user.role}</td>
        <td class="py-2 px-4">${user.created}</td>
        <td class="py-2 px-4 flex gap-3">
          <button class="edit-user-btn" data-id="${user.id}" title="Edit">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500 hover:text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h6" />
            </svg>
          </button>
          <button class="delete-user-btn" data-id="${user.id}" title="Delete">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500 hover:text-red-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </td>
      </tr>`;
    }
    html += `</tbody></table>`;
    document.getElementById('userManagementContainer').innerHTML = html;
  };
})();
</script> 