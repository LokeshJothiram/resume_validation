<div class="p-2 md:p-8 bg-gray-50 min-h-[80vh]">
  <!-- Header Row: Title/Subtitle left, Add User right -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
    <div>
      <h2 class="text-2xl md:text-3xl font-bold header-gradient flex items-center gap-2">
        <span><svg xmlns='http://www.w3.org/2000/svg' class='inline w-8 h-8 text-blue-500' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z' /></svg></span>
        User Management
      </h2>
      <p class="text-gray-500 mt-1">Manage users, roles, and permissions</p>
    </div>
    <button id="addUserBtn" class="bg-blue-600 text-white px-5 py-2 rounded text-sm font-semibold shadow hover:bg-blue-700 transition self-start md:self-auto"> <svg xmlns='http://www.w3.org/2000/svg' class='inline w-5 h-5 mr-1 -mt-1' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4v16m8-8H4' /></svg> Add New User</button>
  </div>

  <!-- Summary Cards Row (Box/Card Design) -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-6">
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col items-start min-w-[220px]">
      <div class="flex items-center gap-2 mb-2">
        <span class="bg-gray-100 p-2 rounded-full"><svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 text-blue-400' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87M16 3.13a4 4 0 010 7.75M8 3.13a4 4 0 000 7.75' /></svg></span>
        <span class="font-semibold">Total Users</span>
      </div>
      <div class="text-3xl font-bold" id="total-users-count">0</div>
      <div class="text-xs text-gray-500">registered users</div>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col items-start min-w-[220px]">
      <div class="flex items-center gap-2 mb-2">
        <span class="bg-gray-100 p-2 rounded-full"><svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 text-green-400' fill='none' viewBox='0 0 24 24' stroke='currentColor'><circle cx='12' cy='12' r='10' fill='white'/><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7' /></svg></span>
        <span class="font-semibold">Active Users</span>
      </div>
      <div class="text-3xl font-bold" id="active-users-count">0</div>
      <div class="text-xs text-gray-500">currently active</div>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col items-start min-w-[220px]">
      <div class="flex items-center gap-2 mb-2">
        <span class="bg-gray-100 p-2 rounded-full"><svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 text-red-400' fill='none' viewBox='0 0 24 24' stroke='currentColor'><circle cx='12' cy='12' r='10' fill='white'/><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12' /></svg></span>
        <span class="font-semibold">Inactive Users</span>
      </div>
      <div class="text-3xl font-bold" id="inactive-users-count">0</div>
      <div class="text-xs text-gray-500">currently inactive</div>
    </div>
    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6 flex flex-col items-start min-w-[220px]">
      <div class="flex items-center gap-2 mb-2">
        <span class="bg-gray-100 p-2 rounded-full"><svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 text-yellow-400' fill='none' viewBox='0 0 24 24' stroke='currentColor'><circle cx='12' cy='12' r='10' fill='white'/><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4l3 3' /></svg></span>
        <span class="font-semibold">Pending Users</span>
      </div>
      <div class="text-3xl font-bold" id="pending-users-count">0</div>
      <div class="text-xs text-gray-500">awaiting approval</div>
    </div>
  </div>

  <!-- Search and Filter Row -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
    <input id="user-search" type="text" placeholder="Search users..." class="w-full md:w-72 px-4 py-2 border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-200" />
    <div class="flex gap-2 mt-2 md:mt-0">
      <button class="user-filter-tab px-4 py-1 rounded font-semibold text-sm bg-blue-100 text-blue-700" data-filter="all">All</button>
      <button class="user-filter-tab px-4 py-1 rounded font-semibold text-sm hover:bg-green-100 hover:text-green-700" data-filter="active">Active</button>
      <button class="user-filter-tab px-4 py-1 rounded font-semibold text-sm hover:bg-red-100 hover:text-red-700" data-filter="inactive">Inactive</button>
      <button class="user-filter-tab px-4 py-1 rounded font-semibold text-sm hover:bg-yellow-100 hover:text-yellow-700" data-filter="pending">Pending</button>
    </div>
  </div>

  <!-- User Table (Modern Card Design) -->
  <div id="userManagementContainer" class="bg-white border border-gray-200 rounded-2xl shadow-sm p-4 md:p-6 min-h-[400px] overflow-x-auto w-full">
    <!-- Table will be rendered dynamically by JS. Username column should include a user avatar (gradient circle with initial) left of the username, using flex layout. -->
  </div>

  <!-- User Management Info Section -->
  <!-- Removed User Management Tips and User Role Summary as per request -->
  <!-- Edit User Modal Placeholder -->
  <div id="edit-user-modal-root"></div>
  <!-- Delete User Modal Placeholder -->
  <div id="delete-user-modal-root"></div>
</div>
<!-- Delete User Confirmation Modal -->
<div id="delete-user-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
    <div class="text-lg font-semibold mb-4">Delete User</div>
    <div id="delete-user-modal-msg" class="mb-4 text-gray-700">Are you sure you want to delete this user?</div>
    <div class="flex justify-center gap-4 mt-6">
      <button id="delete-user-confirm" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 font-semibold">Delete</button>
      <button id="delete-user-cancel" class="bg-gray-200 text-gray-700 px-6 py-2 rounded hover:bg-gray-300 font-semibold">Cancel</button>
    </div>
  </div>
</div>
<script>
(function() {
  let pendingDeleteUserId = null;
  let pendingDeleteUsername = '';
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('userManagementContainer');
    const modal = document.getElementById('delete-user-modal');
    const msg = document.getElementById('delete-user-modal-msg');
    const confirmBtn = document.getElementById('delete-user-confirm');
    const cancelBtn = document.getElementById('delete-user-cancel');
    // Delegate delete button clicks
    container.addEventListener('click', function(e) {
      if (e.target.classList.contains('delete-user-btn')) {
        const userId = e.target.getAttribute('data-id');
        const username = e.target.closest('tr').querySelector('td').innerText.trim();
        pendingDeleteUserId = userId;
        pendingDeleteUsername = username;
        msg.textContent = `Are you sure you want to delete user '${username}'? This cannot be undone.`;
        modal.classList.remove('hidden');
      }
    });
    confirmBtn.onclick = function() {
      if (!pendingDeleteUserId) return;
      fetch(`/admin_users/${pendingDeleteUserId}`, { method: 'DELETE' })
        .then(resp => resp.json())
        .then(data => {
          if (data.status === 'success') {
            showToast('User deleted!', 'success');
            // Remove user from global and re-render
            window._allUsers = window._allUsers.filter(u => u.id != pendingDeleteUserId);
            if (typeof renderUserManagement === 'function') renderUserManagement();
            if (window.refreshAdminDashboardSummary) window.refreshAdminDashboardSummary();
            if (window.refreshAdminRecentActivity) window.refreshAdminRecentActivity();
          } else {
            showToast(data.error || 'Failed to delete user.', 'error');
          }
          modal.classList.add('hidden');
          pendingDeleteUserId = null;
        })
        .catch(() => {
          showToast('Error deleting user.', 'error');
          modal.classList.add('hidden');
          pendingDeleteUserId = null;
        });
    };
    cancelBtn.onclick = function() {
      modal.classList.add('hidden');
      pendingDeleteUserId = null;
    };
  });
})();
</script> 